<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>wsServer Coding Style | wsServer | a very tiny WebSocket server library written in C</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="icon" href="favicon-dark.png" type="image/png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
  <style>
    li {margin-top: 10px;}
  </style>
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">wsServer <span class="m-thin">| a very tiny WebSocket server library written in C</span></a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Pages</a></li>
            <li><a href="namespaces.html">Namespaces</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="3">
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="files.html">Files</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
            <li class="m-show-m"><a target="_blank" href="https://github.com/Theldus/wsServer" class="m-doc-search-icon" title="GitHub Page">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            </a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          wsServer Coding Style
        </h1>
<p>wsServer is a simple project, and therefore I don&#x27;t believe there is so much interest in it. However, as I have received a few contributions over the years, it may be interesting to write something about it.</p><p>(much of what is here is (heavily-)based on <a href="https://github.com/nanvix/documentation/blob/master/6-contrib/3-coding-style.md">Nanvix</a>&#x27;s and <a href="https://www.kernel.org/doc/html/v4.10/process/coding-style.html">Linux</a>&#x27;s coding style.)</p><section id="autotoc_md4"><h2><a href="#autotoc_md4">Indentation</a></h2><ul><li><em>Always</em> use <strong>tab</strong> characters for indentation.</li><li>Tab width: 4 characters.</li><li><p>Indent case labels in switch statements, such as:</p><pre class="m-code"><span class="k">switch</span> <span class="p">(</span><span class="n">var</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">case</span> <span class="nl">bar</span><span class="p">:</span>
        <span class="n">something</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">beef</span><span class="p">:</span>
        <span class="n">something</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span></pre></li><li>Do not put multiples statements nor multiples assignments in a single line.</li></ul></section><section id="autotoc_md5"><h2><a href="#autotoc_md5">Long lines length</a></h2><ul><li>Even though Mr. Torvalds has <a href="https://www.theregister.com/2020/06/01/linux_5_7/">said</a> that nowadays it is ok to use large lines, I&#x27;ll keep to 80 columns with five (85) of tolerance. However, use common sense here.</li><li>While breaking long lines, indent the next line at one level.</li></ul></section><section id="autotoc_md6"><h2><a href="#autotoc_md6">Placing Braces and Spaces</a></h2><ul><li>Allman style: whether functions or control statements, place the braces always in the next line. Statements within the braces are indented at one level.</li></ul><p>Ex:</p><pre class="m-code"><span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">something</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">bar</span><span class="p">();</span>
        <span class="n">baz</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">deadbeef</span><span class="p">();</span>

    <span class="n">something_else</span><span class="p">();</span> <span class="cm">/* put always a blank line between a control block</span>
<span class="cm">                without braces and the next statement. */</span>
<span class="p">}</span></pre><ul><li>If one line is enough (like function call or variable assignment), do not put braces. Keep in mind the readability: put a blank line between statements.</li></ul></section><section id="autotoc_md7"><h2><a href="#autotoc_md7">Spaces</a></h2><ul><li>Use one space after these keywords: <code>if, switch, case, for, do, while</code>.</li><li>Use one space around (on each side of) most binary and ternary operators: <code>= + - &lt; &gt; * / % | &amp; ^ &lt;= &gt;= == != ? :</code>.</li><li>But no space after unary operators: <code>&amp; * + - ~ ! sizeof</code>.</li><li>No space after/before the postfix/prefix increment &amp; decrement unary operators: <code>++ --</code>.</li></ul></section><section id="autotoc_md8"><h2><a href="#autotoc_md8">Variables and Naming</a></h2><ul><li>Do not use mixed-cases to name your variables. Always use lower-case for variables and functions name. Underscores are acceptable to give a more descriptive name, e.g., <code>int next_frame(...)</code>.</li><li>Always use uppercase for macros.</li><li>Do not use <em>typedef</em> s unless for totally opaque objects. The reasoning is simple: it <em>hides</em> the original meaning of the variable. Is it a union, struct, an integer?.</li><li>(Try to) do not mix variable declaration with your code. Declare your variables at the very beginning of the scope of that variable.</li></ul></section><section id="autotoc_md9"><h2><a href="#autotoc_md9">Commenting/Documenting</a></h2><ul><li>Use always <code>/* c89 style. */</code> in your code, even for a single line.</li><li>Use Doxygen syntax to document functions and structures, even for the internal API.</li></ul><hr/></section><section id="autotoc_md11"><h2><a href="#autotoc_md11">Using clang-format</a></h2><p><code>clang-format</code> is a command-line tool, part of the LLVM project that, for a pre-defined set of rules or a given file, automatically formats source code. wsServer comes with a .clang-format file in the root directory that tries to embrace most of these rules above.</p><p>Please note that the .clang-format file does not fully cover everything described here and even in cases that do, it is always important to carefully evaluate the output generated by it, since sometimes it may be far from ideal, use common sense here.</p><p>My suggestion would be something like:</p><ul><li>Commit what you need to commit (<strong>locally</strong>).</li><li>Apply clang-format over the file: <code>clang-format -style=file -i src/file.c</code>.</li><li>Manually check changes on the file.</li><li>Make a commit amend if applicable.</li></ul><p>Similarly, instead of performing an amend, you can also generate a newly formatted file and then perform a diff of the original with the new one:</p><pre class="m-code">clang-format -style<span class="o">=</span>file file.c &gt; newfile.c
diff -u file.c newfile.c &gt; diffs.patch        <span class="c1"># see this file</span></pre><p>Pick what you think is best.</p></section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v1.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>wsServer | a very tiny WebSocket server library written in C. Created with <a href="https://doxygen.org/">Doxygen</a> 1.8.20 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
